<script lang="ts">
    import mapImage from "../lib/map.png"; 
    import {onMount} from 'svelte';
    import {CircleMarker, GeoJSON, LeafletMap, Polygon, Popup, TileLayer, Tooltip} from 'svelte-leafletjs';
    import {CRS, ImageOverlay, type GeoJSONOptions, type LatLngBoundsExpression, type LatLngExpression, type MapOptions, type TileLayerOptions} from 'leaflet';
    import { convertSvgCoordinates } from "../lib/utils";

    const mapOptions: MapOptions = {
        // center: [1.250111, 103.830933],
        // zoom: 13,
        crs: CRS.Simple
    };
    const tileUrl = "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";
    const tileLayerOptions: TileLayerOptions = {
        minZoom: 0,
        maxZoom: 20,
        maxNativeZoom: 19,
        attribution: "© OpenStreetMap contributors",
    };
    const geoJsonOptions: GeoJSONOptions = {
        style: function (geoJsonFeature) {
            console.log('style', geoJsonFeature);
            return {};
        },
        onEachFeature: function (feature, layer) {
            console.log('onEachFeature', feature, layer);
        },
    };

    let leafletMap: LeafletMap;
    const bounds =  [[0,0], [1304, 1724]] as LatLngBoundsExpression;
    onMount(() => {
        if (leafletMap) {
            const map = leafletMap.getMap();
            if (map) {
                let imageOverlay = new ImageOverlay(mapImage, bounds).addTo(map)
                map.fitBounds(bounds);
            }
        }
    });
    

    // const polygon1: LatLngExpression[] = mirrorCoordinateVertically(
        // [[783, 804], [783, 814], [794, 811], [801, 815], [807, 816], [813, 819], [816, 821], [822, 829], [824, 832], [828, 841], [828, 842], [837, 844], [838, 840], [845, 842], [852, 841], [855, 843], [864, 842], [866, 834], [868, 830], [867, 820], [871, 820], [871, 817], [872, 809], [869, 804], [871, 800], [867, 792], [870, 794], [877, 791], [880, 795], [886, 793], [894, 795], [896, 797], [906, 797], [906, 797], [907, 793], [916, 797], [925, 799], [926, 804], [923, 806], [925, 810], [933, 806], [937, 810], [942, 807], [948, 809], [952, 806], [961, 804], [962, 799], [965, 801], [976, 803], [977, 812], [976, 814], [977, 820], [975, 828], [982, 828], [982, 831], [984, 834], [994, 835], [994, 843], [1006, 835], [1007, 829], [1000, 823], [1000, 819], [994, 813], [992, 812], [992, 802], [986, 795], [991, 794], [992, 787], [994, 787], [994, 784], [999, 774], [1003, 770], [1000, 764], [998, 763], [998, 752], [996, 748], [1005, 747], [1006, 743], [1005, 742], [1004, 732], [1003, 732], [1003, 722], [1002, 718], [997, 714], [997, 712], [995, 708], [987, 709], [986, 699], [977, 698], [977, 693], [981, 693], [984, 683], [993, 680], [993, 678], [991, 669], [988, 669], [988, 665], [986, 662], [977, 651], [976, 649], [976, 647], [976, 642], [978, 641], [978, 634], [971, 620], [973, 619], [975, 616], [975, 613], [974, 613], [974, 605], [976, 602], [978, 595], [978, 591], [975, 584], [976, 580], [972, 575], [973, 571], [979, 571], [981, 575], [986, 575], [989, 579], [999, 579], [999, 568], [1000, 566], [992, 558], [990, 556], [997, 547], [1002, 540], [997, 539], [994, 536], [992, 533], [984, 528], [980, 527], [974, 521], [971, 523], [959, 518], [959, 513], [949, 514], [947, 512], [941, 513], [939, 511], [927, 511], [927, 509], [921, 511], [915, 510], [913, 511], [905, 509], [902, 498], [900, 497], [901, 492], [899, 488], [895, 484], [895, 475], [888, 478], [884, 478], [876, 488], [871, 495], [872, 496], [871, 506], [868, 509], [867, 509], [858, 516], [849, 526], [849, 529], [838, 534], [838, 546], [827, 546], [823, 556], [820, 566], [827, 574], [824, 577], [826, 588], [823, 588], [807, 599], [805, 603], [813, 604], [819, 619], [819, 621], [820, 622], [823, 625], [828, 642], [819, 644], [825, 656], [826, 662], [836, 669], [836, 674], [840, 683], [838, 688], [834, 702], [836, 711], [824, 715], [823, 719], [825, 737], [819, 736], [815, 749], [800, 753], [806, 767], [810, 769], [808, 768], [797, 770], [793, 781], [792, 787]]
    // )
    const svgMap1 = "M1080,482 L1081,466 1089,465 1101,479 1104,478 1121,483 1128,479 1130,481 1145,476 1152,478 1153,479 1163,480 1166,476 1180,475 1183,478 1191,479 1197,492 1212,485 1212,486 1216,489 1228,491 1232,488 1240,490 1250,482 1258,481 1258,480 1270,478 1277,465 1290,472 1291,481 1301,480 1310,485 1309,493 1315,493 1324,506 1323,510 1332,515 1333,525 1346,525 1348,527 1355,528 1359,539 1358,541 1341,538 1339,540 1330,540 1332,552 1319,560 1320,562 1304,572 1305,582 1292,583 1284,592 1284,592 1278,605 1282,611 1267,617 1267,625 1266,626 1265,633 1260,637 1244,632 1242,634 1241,642 1230,648 1221,641 1221,641 1209,639 1204,639 1203,638 1189,640 1188,627 1180,623 1175,631 1161,627 1161,626 1149,624 1146,615 1142,615 1134,609 1125,615 1122,612 1118,599 1107,598 1106,597 1092,603 1087,600 1074,615 1066,615 1063,607 1063,606 1051,588 1042,601 1030,596 1025,602 1017,603 1012,594 1008,594 994,587 1007,575 1008,570 1008,569 1010,569 1017,552 1022,549 1021,543 1023,536 1036,533 1037,531 1047,528 1050,526 1047,515 1063,509 1063,508 1076,514 1085,506 1080,495 1095,490 1098,482 1080,482 Z"
    const svgMap2 = "M795,782 L801,783 804,783 814,794 811,801 815,807 816,813 819,816 821,822 829,824 832,828 841,828 842,837 844,838 840,845 842,852 841,855 843,864 842,866 834,868 830,867 820,871 820,871 817,872 809,869 804,871 800,867 792,870 794,877 791,880 795,886 793,894 795,896 797,906 797,906 797,907 793,916 797,925 799,926 804,923 806,925 810,933 806,937 810,942 807,948 809,952 806,961 804,962 799,965 801,976 803,977 812,976 814,977 820,975 828,982 828,982 831,984 834,994 835,994 843,1006 835,1007 829,1000 823,1000 819,994 813,992 812,992 802,986 795,991 794,992 787,994 787,994 784,999 774,1003 770,1000 764,998 763,998 752,996 748,1005 747,1006 743,1005 742,1004 732,1003 732,1003 722,1002 718,997 714,997 712,995 708,987 709,986 699,977 698,977 693,981 693,984 683,993 680,993 678,991 669,988 669,988 665,986 662,977 651,976 649,976 647,976 642,978 641,978 634,971 620,973 619,975 616,975 613,974 613,974 605,976 602,978 595,978 591,975 584,976 580,972 575,973 571,979 571,981 575,986 575,989 579,999 579,999 568,1000 566,992 558,990 556,997 547,1002 540,997 539,994 536,992 533,984 528,980 527,974 521,971 523,959 518,959 513,949 514,947 512,941 513,939 511,927 511,927 509,921 511,915 510,913 511,905 509,902 498,900 497,901 492,899 488,895 484,895 475,888 478,884 478,876 488,871 495,872 496,871 506,868 509,867 509,858 516,849 526,849 529,838 534,838 546,827 546,823 556,820 566,827 574,824 577,826 588,823 588,807 599,805 603,813 604,819 619,819 621,820 622,823 625,828 642,819 644,825 656,826 662,836 669,836 674,840 683,838 688,834 702,836 711,824 715,823 719,825 737,819 736,815 749,800 753,806 767,810 769,808 768,797 770,793 781,792 787,779 789,778 795,782 ZM832,959 L837,965 835,968 826,968 826,960 827,959 832,959 Z"
    const svgMap3 = "M270,295 L270,299 274,306 274,309 279,316 275,323 276,328 275,334 273,335 271,342 273,347 272,350 277,359 281,361 282,362 281,370 273,373 272,372 264,372 261,374 255,373 249,374 248,378 241,382 241,388 231,392 229,402 241,405 242,406 240,417 253,427 251,432 253,436 254,441 259,445 256,457 269,465 270,468 285,464 289,466 287,478 302,485 301,489 303,494 297,509 294,511 295,521 289,531 290,541 296,543 298,551 299,553 310,559 310,560 300,572 304,581 312,582 317,597 321,599 317,616 326,618 327,619 327,631 334,634 336,639 345,645 345,653 347,656 354,658 368,644 372,645 379,631 388,631 391,635 402,634 404,631 416,631 420,625 431,628 435,624 436,615 438,612 445,611 448,595 461,600 464,582 478,585 474,565 482,563 490,554 490,554 506,560 514,555 506,540 497,541 490,523 490,522 511,528 514,523 517,522 519,518 513,499 517,497 520,492 535,487 537,481 539,479 537,469 543,460 538,453 537,453 534,449 530,448 524,444 519,444 512,438 511,435 510,435 505,428 505,424 495,417 491,418 490,417 487,418 479,413 477,406 471,401 465,402 463,402 454,404 452,403 449,399 450,392 443,388 443,382 439,379 438,374 436,371 431,371 427,368 423,368 417,364 415,357 415,357 421,353 424,346 419,343 412,343 407,335 407,335 404,330 401,329 397,330 389,326 389,323 391,316 390,313 390,307 399,301 399,300 405,300 407,301 410,301 418,294 418,286 409,283 408,281 406,281 400,282 398,281 390,282 387,284 378,286 375,285 369,289 367,292 367,295 360,304 359,304 354,303 345,306 344,309 343,311 334,315 328,313 327,313 320,312 317,315 309,314 307,315 300,314 298,315 293,314 288,307 293,299 295,298 299,289 293,284 288,282 283,283 279,281 270,281 268,292 270,295 Z"
    // const polygon2 =[[783, 804], [783, 814], [794, 811], [801, 815], [807, 816], [813, 819], [816, 821], [822, 829], [824, 832], [828, 841], [828, 842], [837, 844], [838, 840], [845, 842], [852, 841], [855, 843], [864, 842], [866, 834], [868, 830], [867, 820], [871, 820], [871, 817], [872, 809], [869, 804], [871, 800], [867, 792], [870, 794], [877, 791], [880, 795], [886, 793], [894, 795], [896, 797], [906, 797], [906, 797], [907, 793], [916, 797], [925, 799], [926, 804], [923, 806], [925, 810], [933, 806], [937, 810], [942, 807], [948, 809], [952, 806], [961, 804], [962, 799], [965, 801], [976, 803], [977, 812], [976, 814], [977, 820], [975, 828], [982, 828], [982, 831], [984, 834], [994, 835], [994, 843], [1006, 835], [1007, 829], [1000, 823], [1000, 819], [994, 813], [992, 812], [992, 802], [986, 795], [991, 794], [992, 787], [994, 787], [994, 784], [999, 774], [1003, 770], [1000, 764], [998, 763], [998, 752], [996, 748], [1005, 747], [1006, 743], [1005, 742], [1004, 732], [1003, 732], [1003, 722], [1002, 718], [997, 714], [997, 712], [995, 708], [987, 709], [986, 699], [977, 698], [977, 693], [981, 693], [984, 683], [993, 680], [993, 678], [991, 669], [988, 669], [988, 665], [986, 662], [977, 651], [976, 649], [976, 647], [976, 642], [978, 641], [978, 634], [971, 620], [973, 619], [975, 616], [975, 613], [974, 613], [974, 605], [976, 602], [978, 595], [978, 591], [975, 584], [976, 580], [972, 575], [973, 571], [979, 571], [981, 575], [986, 575], [989, 579], [999, 579], [999, 568], [1000, 566], [992, 558], [990, 556], [997, 547], [1002, 540], [997, 539], [994, 536], [992, 533], [984, 528], [980, 527], [974, 521], [971, 523], [959, 518], [959, 513], [949, 514], [947, 512], [941, 513], [939, 511], [927, 511], [927, 509], [921, 511], [915, 510], [913, 511], [905, 509], [902, 498], [900, 497], [901, 492], [899, 488], [895, 484], [895, 475], [888, 478], [884, 478], [876, 488], [871, 495], [872, 496], [871, 506], [868, 509], [867, 509], [858, 516], [849, 526], [849, 529], [838, 534], [838, 546], [827, 546], [823, 556], [820, 566], [827, 574], [824, 577], [826, 588], [823, 588], [807, 599], [805, 603], [813, 604], [819, 619], [819, 621], [820, 622], [823, 625], [828, 642], [819, 644], [825, 656], [826, 662], [836, 669], [836, 674], [840, 683], [838, 688], [834, 702], [836, 711], [824, 715], [823, 719], [825, 737], [819, 736], [815, 749], [800, 753], [806, 767], [810, 769], [808, 768], [797, 770], [793, 781], [792, 787]]
        </script>

<div class="example" style="width: 100%; height: 100%;">

        <LeafletMap bind:this={leafletMap} options={mapOptions}>
            <Polygon latLngs={convertSvgCoordinates(svgMap1)} color="#03b000" fillColor="#30b82e" options={{}}>
                <Tooltip>Ryan's Maggotkin Of Nurgle</Tooltip>
                <Popup>
                    <div class="flexlist">
                        <div class="bolden">

                            Ryan's Pox-born Disease 2000/2000 pts
                        </div>

                        <div>Maggotkin of Nurgle | Tallyband of Nurgle</div>
                        <div>Drops: 3</div>
                        <div>Spell Lore - Lore of Malignance</div>
                        <div>Manifestation Lore - Primal Energy</div>

                        <div>General's Regiment</div>
                        <div>Great Unclean One (480)</div>
                        <div>• General
                        </div> <div>• Grandfather's Blessing
                        </div> <div>• Rustfang
                        </div><div>Plaguebearers (140)</div>
                        <div>Plaguebearers (140)</div>
                        <div>Plaguebearers (140)</div>
                        <div>Poxbringer, Herald of Nurgle (120)</div>

                        <div>Regiment 1</div>
                        <div>Lord of Plagues (130)</div>
                        <div>Putrid Blightkings (190)</div>
                        <div>Putrid Blightkings (190)</div>

                        <div>Regiment 2</div>
                        <div>Lord of Afflictions (220)</div>
                        <div>Pusgoyle Blightlords (250)</div>
                    </div>
                </Popup>
            </Polygon>  
            <Polygon latLngs={convertSvgCoordinates(svgMap3)} color="#fffc57" fillColor="#fffda6">
                <Tooltip>Jordan's Stormcast Dragon-Kin</Tooltip>
                                <Popup>
                    <div class="flexlist">
                        <div class="bolden">

                            Jordan's Stormcast Dragon-Kin 2000/2000 pts
                        </div>

                        <div>Maggotkin of Nurgle | Tallyband of Nurgle</div>
                        <div>Drops: 3</div>
                        <div>Spell Lore - Lore of Malignance</div>
                        <div>Manifestation Lore - Primal Energy</div>

                        <div>General's Regiment</div>
                        <div>Great Unclean One (480)</div>
                        <div>• General
                        </div> <div>• Grandfather's Blessing
                        </div> <div>• Rustfang
                        </div><div>Plaguebearers (140)</div>
                        <div>Plaguebearers (140)</div>
                        <div>Plaguebearers (140)</div>
                        <div>Poxbringer, Herald of Nurgle (120)</div>

                        <div>Regiment 1</div>
                        <div>Lord of Plagues (130)</div>
                        <div>Putrid Blightkings (190)</div>
                        <div>Putrid Blightkings (190)</div>

                        <div>Regiment 2</div>
                        <div>Lord of Afflictions (220)</div>
                        <div>Pusgoyle Blightlords (250)</div>
                    </div>
                </Popup>
            </Polygon>  
            <Polygon latLngs={convertSvgCoordinates(svgMap2)} color="#e34017" fillColor="#cf6d55">
                <Tooltip>Cass' Orruks</Tooltip>
                                <Popup>
                    <div class="flexlist">
                        <div class="bolden">

                            Cass' Orruks 2000/2000 pts
                        </div>

                        <div>Maggotkin of Nurgle | Tallyband of Nurgle</div>
                        <div>Drops: 3</div>
                        <div>Spell Lore - Lore of Malignance</div>
                        <div>Manifestation Lore - Primal Energy</div>

                        <div>General's Regiment</div>
                        <div>Great Unclean One (480)</div>
                        <div>• General
                        </div> <div>• Grandfather's Blessing
                        </div> <div>• Rustfang
                        </div><div>Plaguebearers (140)</div>
                        <div>Plaguebearers (140)</div>
                        <div>Plaguebearers (140)</div>
                        <div>Poxbringer, Herald of Nurgle (120)</div>

                        <div>Regiment 1</div>
                        <div>Lord of Plagues (130)</div>
                        <div>Putrid Blightkings (190)</div>
                        <div>Putrid Blightkings (190)</div>

                        <div>Regiment 2</div>
                        <div>Lord of Afflictions (220)</div>
                        <div>Pusgoyle Blightlords (250)</div>
                    </div>
                </Popup>
            </Polygon>  
            <!-- <TileLayer url={tileUrl} options={tileLayerOptions}/>
            <GeoJSON options={geoJsonOptions}/> 
            <CircleMarker latLng={[1.2461196,103.8298412]}></CircleMarker> -->
        </LeafletMap>
</div>

<style>
    .bolden {
        font-weight: 700;
    }
    .list {
        display:flex;
        flex-direction: column;
    }
</style>